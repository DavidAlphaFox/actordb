<!DOCTYPE html>
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head prefix="og: http://ogp.me/ns#">
        <!--<meta charset="utf-8">-->
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>ActorDB | Documentation</title>        
        <meta name="description" content="ActorDB is strongly consistent, distributed and horizontally scalable. Unlike traditional monolithic databases, ActorDB is made out of any number of independent and concurrent SQL databases called actors.">
        <meta name="viewport" content="width=device-width">
        <meta property="og:title" content="ActorDB | Documentation" />
        <meta property="og:description" content="ActorDB is strongly consistent, distributed and horizontally scalable. Unlike traditional monolithic databases, ActorDB is made out of any number of independent and concurrent SQL databases called actors." />
        <meta property="og:site_name" content="ActorDB" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="http://www.actordb.com/" />
        <meta property="og:image" content="http://www.actordb.com/imgs/actordb_fb_logo.png" />
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
        <link rel="stylesheet" href="css/bootstrap.css">
        <link rel="stylesheet" href="css/actordb-website.css">
        <script src="js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>
        <script src="js/vendor/jquery-1.10.1.min.js"></script>
        <link href='http://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic' rel='stylesheet' type='text/css'>
        <style>
            .block {
                display:block !Important;
            }
        </style>
        <script>
            $(document).ready(function(){
                $("#mobile_menu").click(function(evt){
                    $(this).siblings(".navigation").toggleClass("block");
                });
            });
        </script>
        <!--[if gte IE 9]>
          <style type="text/css">
            .gradient {filter: none;}
          </style>
        <![endif]-->
    </head>    
    <body id="view320logo" >
        <!--[if lt IE 9]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->
        <div class="header">
            <div class="pagewrapper clearfix">
                <a href="" class="global-header_logo"></a>
                <a href="" class="global320-header_logo_text global-header_logo_text"></a>
                <ul class="navigation">
                    <li ><a href="index.html">Home</a></li>
                    <li  class="sel"><a href="docs-about.html">Documentation</a></li>
                    <li><a target="_blank" href="https://www.github.com/biokoda/actordb">Source</a></li>
                    <li class=" "><a href="downloads.html">Downloads</a></li>
                    <!-- <li class="  right"><a target="_blank" href="downloads.html">Downloads</a></li> -->
                </ul>
                <span id="mobile_menu" class="menu"></span>
            </div>
        </div>

        <script>
$(document).ready(function(){
    $(".collapsed > .title").click(function(evt){        
        $(this).parent().toggleClass("expanded");
        return false;
    });
});
</script>
<div class="pagecontainer">
    <div class="pagewrapper clearfix">
        <div class="leftmenu">

            <div class="l1">
                <a href="docs-about.html" class="title">
                    <span class="text">1. ABOUT</span>
                </a>
            </div>
            <div class="l1 collapsed ">
                <a href="docs-getstarted.html" class="title">
                    <span class="bullet"></span>
                    <span class="text">2. GET STARTED</span>
                </a>
                <div class="l2">
                    <a href="docs-getstarted.html#download_run" class="title">
                        <span class="text">2.1 Download and run ActorDB</span>
                    </a>
                    <a href="docs-getstarted.html#run" class="title">
                        <span class="text">2.2 Run ActorDB</span>
                    </a>
                    <a href="docs-getstarted.html#insertandquery" class="title">
                        <span class="text">2.3 Simple insert and query data</span>
                    </a>

                    <div class="l3 collapsed expanded">
                        <a href="docs-getstarted.html#crud" class="title">
                            <span class="bullet"></span>
                            <span class="text">2.4 CRUD in ActorDB</span>
                        </a>
                        <a href="docs-getstarted.html#create" class="text last">2.4.1 Create</a>
                        <a href="docs-getstarted.html#read" class="text last">2.4.2 Reading actors and tables</a>
                        <a href="docs-getstarted.html#update" class="text last">2.4.3 Updating tables in actors</a>
                        <a href="docs-getstarted.html#delete" class="text last">2.4.4 Deleting tables in actors and actors itself</a>
                    </div>
                </div>
            </div>
            <div class="l1 collapsed ">
                <a href="docs-howitworks.html" class="title">
                    <span class="bullet"></span>
                    <span class="text">3. HOW IT WORKS</span>
                </a>
                <div class="l2">
                    <a href="docs-howitworks.html#overview" class="title">
                        <span class="text">3.1 Overview</span>
                    </a>
                    <div class="l3 collapsed expanded">
                        <a href="docs-howitworks.html#nodesyny" class="title">
                            <span class="bullet"></span>
                            <span class="text">3.2 Node synchronisation</span>
                        </a>
                        <a href="docs-howitworks.html#h_321" class="text last">3.2.1 Global state</a>
                        <a href="docs-howitworks.html#h_322" class="text last">3.2.2 Actors</a>
                        <a href="docs-howitworks.html#h_323" class="text last">3.2.3 Multi-actor transactions</a>
                    </div>
                    <a href="docs-howitworks.html#dbengine" class="title">
                        <span class="text">3.3 Database engine</span>
                    </a>
                </div>
            </div>
            <div class="l1 collapsed ">
                <a href="docs-querymodel.html" class="title">
                    <span class="bullet"></span>
                    <span class="text">4. QUERY MODEL</span>
                </a>
                <div class="l2">
                    <div class="l3 collapsed expanded">
                        <a href="docs-querymodel.html#query_actor" class="title">
                            <span class="bullet"></span>
                            <span class="text">4.1 ACTOR statement</span>
                        </a>
                        <a href="docs-querymodel.html#h_411" class="last">4.1.1 Single actor</a>
                        <a href="docs-querymodel.html#h_412" class="last">4.1.2 Multiple actors</a>
                        <a href="docs-querymodel.html#h_413" class="last">4.1.3 All actors of a type</a>
                        <a href="docs-querymodel.html#h_414" class="last">4.1.4 Loop over actors</a>
                    </div>
                </div>
                <div class="l2">
                    <div class="l3 collapsed expanded">
                        <a href="docs-querymodel.html#query_variables" class="title">
                            <span class="bullet"></span>
                            <span class="text">4.2 Variables</span>
                        </a>
                        <a href="docs-querymodel.html#h_421" class="last">4.2.1 Appending columns to result</a>
                    </div>
                    
                        
                </div>
               
                        <a href="docs-querymodel.html#query_pragma" class="last">
                            
                            <span class="text">4.3 Pragma statement</span>
                        </a>
                   

            </div>


            <div class="l1">
                <div class="l3 collapsed expanded">
                        <a href="docs-kvstore.html" class="title">
                            <span class="bullet"></span>
                            <span class="text">5. KEY/VALUE STORE</span>
                        </a>
                        <a href="docs-kvstore.html#about_kv_store" class="last">5.1 About</a>
                        <a href="docs-kvstore.html#reliable_distributed_counters" class="last">5.2 Use case: reliable distributed counters</a>
                </div>
                

                
            </div>
           
            <div class="l1 collapsed ">
                <a href="docs-examples.html" class="title">
                    <span class="bullet"></span>
                    <span>6. EXAMPLES</span>
                </a>
                <a href="docs-examples.html" class="last">
                    <span>Introduction</span>
                </a>
                <a href="docs-examples.html#example_webforum" class="last">
                    <span>6.1 Web forum</span>
                </a>
            </div>

            <div class="l1 collapsed ">
                <a href="docs-configuration.html" class="title">
                    <span class="bullet"></span>
                    <span class="text">7. CONFIGURATION</span>
                </a>
                <a href="docs-configuration.html#conf_files" class="last">
                    <span>7.1 ActorDB configuration files</span>
                </a>
                <a href="docs-configuration.html#conf_nodes" class="last">
                    <span>7.2 nodes.yaml</span>
                </a>
                <a href="docs-configuration.html#conf_schema" class="last">
                    <span>7.3 schema.yaml</span>
                </a>
                <a href="docs-configuration.html#setup_guide" class="last">
                    <span>7.4 Setup guide</span>
                </a>
                <a href="docs-configuration.html#changing_schema" class="last">
                    <span>7.5 Changing schema</span>
                </a>
                <a href="docs-configuration.html#adding_cluster" class="last">
                    <span>7.6 Adding a cluster</span>
                </a>
                <a href="docs-configuration.html#building_actordb" class="last">
                    <span>7.7 Building ActorDB</span>
                </a>
                <a href="docs-configuration.html#running_dev_mode" class="last">
                    <span>7.8 Running ActorDB development mode</span>
                </a>
            </div>

        </div>
        <div class="content">

   				            <h1 id="kvstore" class="pagetitle">5. Key/Value store</h1>
            <h2 id="about_kv_store" class="pagesubtitle">5.1 About Key/Value store</h3> 
            <p class="pagetext">ActorDB can also act as a key/value store by maintaining a sharded table across all clusters. The syntax is a bit verbose, but quite powerful.</p>

            <p class="pagetext">In schema.yaml file you can define a table like this:</p>


            <div class="structure">
                <pre>
counters: 
 type: kv
 schema: 
  - CREATE TABLE actors (id TEXT UNIQUE, hash INTEGER, val INTEGER)</pre>
            </div>

<p class="pagetext">Important:</p>
            <p class="pagetext">- counters is the key/value namespace. You can have multiple namespaces with different table schemas. You can even have multiple tables that are connected with foreign keys to the actors table.
</p>
            <p class="pagetext">- kv specifies this type as a sharded key/value table.</p>
            <p class="pagetext">- table must be named "actors" and it must have id and hash columns. id is key, hash is hash of id, everything after that is up to you.
</p>
            <br/>
            <p class="pagetext">Inserting a value:</p>


            <div class="structure">
                <pre>
ACTOR counters(mykey);
INSERT INTO actors VALUES ('mykey',{{hash(mykey)}},42);</pre>
            </div>


            <p class="pagetext">Very similar to how actors are queried. First line sets namespace and id. Second line is what gets executed on shard. First two columns must be written like above. If string for key (mykey) is not written the same in all three places, the KV store will not work correctly.</p>
            <p class="pagetext">Let's return the row we inserted earlier:</p>
            
                        <div class="structure">
                            <pre>
            ACTOR counters(mykey);
            INSERT INTO actors VALUES ('mykey',{{hash(mykey)}},42);</pre>
                        </div>
            
            <p class="pagetext">You can return an entire KV namespace with a simple query:</p>


            <div class="structure">
                <pre>
ACTOR counters(*);
{{RESULT}}SELECT * FROM actors;</pre>
            </div>


        

            <h2 id="reliable_distributed_counters" class="pagesubtitle">5.2 Use case: reliable distributed counters</h3>                        

            <p class="pagetext">Say you have an analytics application that needs to be able count pageviews. Single points of failure or data loss are out of the question. You basically have two operations: increment and read counter.
</p>
            <p class="pagetext">If you have 2 clusters of 3 servers. Create 12 counter IDs (24 would probably be better).
</p>
            <p class="pagetext">Pick key for increment: N = RandomNumber % 12.
</p>
            <p class="pagetext">Increment</p>


            <div class="structure">
                <pre>
ACTOR counters(N);
UPDATE actors SET val = val+1 WHERE id='N';</pre>
            </div>


            <p class="pagetext">Read counters</p>


            <div class="structure">
                <pre>
ACTOR counters(1,2,3,4,5,6,7,8,9,10,11,12);
{{RESULT}}SELECT * FROM actors where id='{{curactor}}';</pre>
            </div>


            <p class="pagetext">This will return row for every key. You have to sum them manually however.</p>

<div class="pageactions">
    <span class="goleft"><a href="docs-querymodel.html"><span class="pagebtn"><< Previous</span></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(4. Query model)</span>
    <span class="goright">(6. Examples)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="docs-examples.html"><span class="pagebtn">Next >></span></a></span>   
</div>


   			<p class="pagetext">&nbsp;</p>
            <p class="pagetext">&nbsp;</p>
            <p class="pagetext">&nbsp;</p>
            <p class="pagetext">&nbsp;</p>
            <p class="pagetext">&nbsp;</p>
            <p class="pagetext">&nbsp;</p>
            <p class="pagetext">&nbsp;</p>
            <p class="pagetext">&nbsp;</p>
            <p class="pagetext">&nbsp;</p>
            <p class="pagetext">&nbsp;</p>
            <p class="pagetext">&nbsp;</p>

        </div>
    </div>
</div>

        <div class="footer">
            <div class="pagewrapper">
                <div class="linkholder">
                    <a href="https://www.github.com/biokoda/actordb" class="link">GitHub</a>
                    <a href="https://github.com/biokoda/actordb/issues" class="link">Issues</a>
                    <a href="https://github.com/biokoda/actordb/blob/master/README.md" class="link marginrightzero">Changelog</a>
                </div>
                <p class="text">Product by Biokoda. <br/ >
                    Licensed under Mozilla Public License 2.0.
                </p>
                <a class="global-footer_logo"></a>        
            </div>
        </div>

        <!--<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>-->
        <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.10.1.min.js"><\/script>')</script>
        <script src="js/vendor/bootstrap.min.js"></script>
        <script src="js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>
        
        <script type="text/javascript">
            var isAtLeastIE11 = !!(navigator.userAgent.match(/Trident/) && !navigator.userAgent.match(/MSIE/));
            if (isAtLeastIE11) {
                $("html").addClass("ieedge");
            }
            if (navigator.platform.indexOf("Win") != -1 && navigator.userAgent.indexOf("MSIE") != -1 || navigator.platform.indexOf("Win") != -1 && isAtLeastIE11){
                $("html").addClass("iecomm");
            } 
            if (navigator.platform.indexOf("Win") !=-1 && navigator.userAgent.indexOf("Chrome") != -1) {
                $("html").addClass("winchrome");
            }
        </script>
        <!--<script src="js/actordb-website.js"></script>-->
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-47379916-1', 'actordb.com');
          ga('send', 'pageview');

        </script>
    </body>
</html>

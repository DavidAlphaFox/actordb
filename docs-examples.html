<!DOCTYPE html>
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head prefix="og: http://ogp.me/ns#">
        <!--<meta charset="utf-8">-->
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>ActorDB | Documentation</title>        
        <meta name="description" content="ActorDB is strongly consistent, distributed and horizontally scalable. Unlike traditional monolithic databases, ActorDB is made out of any number of independent and concurrent SQL databases called actors.">
        <meta name="viewport" content="width=device-width">
        <meta property="og:title" content="ActorDB | Documentation" />
        <meta property="og:description" content="ActorDB is strongly consistent, distributed and horizontally scalable. Unlike traditional monolithic databases, ActorDB is made out of any number of independent and concurrent SQL databases called actors." />
        <meta property="og:site_name" content="ActorDB" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="http://www.actordb.com/" />
        <meta property="og:image" content="http://www.actordb.com/imgs/actordb_fb_logo.png" />
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
        <link rel="stylesheet" href="css/bootstrap.css">
        <link rel="stylesheet" href="css/actordb-website.css">
        <script src="js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>
        <script src="js/vendor/jquery-1.10.1.min.js"></script>
        <link href='http://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic' rel='stylesheet' type='text/css'>
        <style>
            .block {
                display:block !Important;
            }
        </style>
        <script>
            $(document).ready(function(){
                $("#mobile_menu").click(function(evt){
                    $(this).siblings(".navigation").toggleClass("block");
                });
            });
        </script>
        <!--[if gte IE 9]>
          <style type="text/css">
            .gradient {filter: none;}
          </style>
        <![endif]-->
    </head>    
    <body id="view320logo" >
        <!--[if lt IE 9]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->
        <div class="header">
            <div class="pagewrapper clearfix">
                <a href="" class="global-header_logo"></a>
                <a href="" class="global320-header_logo_text global-header_logo_text"></a>
                <ul class="navigation">
                    <li ><a href="index.html">Home</a></li>
                    <li  class="sel"><a href="docs-about.html">Documentation</a></li>
                    <li><a target="_blank" href="https://www.github.com/biokoda/actordb">Source</a></li>
                    <li class=" "><a href="downloads.html">Downloads</a></li>
                    <!-- <li class="  right"><a target="_blank" href="downloads.html">Downloads</a></li> -->
                </ul>
                <span id="mobile_menu" class="menu"></span>
            </div>
        </div>

        <script>
$(document).ready(function(){
    $(".collapsed > .title").click(function(evt){        
        $(this).parent().toggleClass("expanded");
        return false;
    });
});
</script>
<div class="pagecontainer">
    <div class="pagewrapper clearfix">
        <div class="leftmenu">

            <div class="l1">
                <a href="docs-about.html" class="title">
                    <span class="text">1. ABOUT</span>
                </a>
            </div>
            <div class="l1 collapsed ">
                <a href="docs-getstarted.html" class="title">
                    <span class="bullet"></span>
                    <span class="text">2. GET STARTED</span>
                </a>
                <div class="l2">
                    <a href="docs-getstarted.html#download_run" class="title">
                        <span class="text">2.1 Download and run ActorDB</span>
                    </a>
                    <a href="docs-getstarted.html#run" class="title">
                        <span class="text">2.2 Run ActorDB</span>
                    </a>
                    <a href="docs-getstarted.html#insertandquery" class="title">
                        <span class="text">2.3 Simple insert and query data</span>
                    </a>

                    <div class="l3 collapsed expanded">
                        <a href="docs-getstarted.html#crud" class="title">
                            <span class="bullet"></span>
                            <span class="text">2.4 CRUD in ActorDB</span>
                        </a>
                        <a href="docs-getstarted.html#create" class="text last">2.4.1 Create</a>
                        <a href="docs-getstarted.html#read" class="text last">2.4.2 Reading actors and tables</a>
                        <a href="docs-getstarted.html#update" class="text last">2.4.3 Updating tables in actors</a>
                        <a href="docs-getstarted.html#delete" class="text last">2.4.4 Deleting tables in actors and actors itself</a>
                    </div>
                </div>
            </div>
            <div class="l1 collapsed ">
                <a href="docs-howitworks.html" class="title">
                    <span class="bullet"></span>
                    <span class="text">3. HOW IT WORKS</span>
                </a>
                <div class="l2">
                    <a href="docs-howitworks.html#overview" class="title">
                        <span class="text">3.1 Overview</span>
                    </a>
                    <div class="l3 collapsed expanded">
                        <a href="docs-howitworks.html#nodesyny" class="title">
                            <span class="bullet"></span>
                            <span class="text">3.2 Node synchronisation</span>
                        </a>
                        <a href="docs-howitworks.html#h_321" class="text last">3.2.1 Global state</a>
                        <a href="docs-howitworks.html#h_322" class="text last">3.2.2 Actors</a>
                        <a href="docs-howitworks.html#h_323" class="text last">3.2.3 Multi-actor transactions</a>
                    </div>
                    <a href="docs-howitworks.html#dbengine" class="title">
                        <span class="text">3.3 SQL engine</span>
                    </a>
                </div>
            </div>
            <div class="l1 collapsed ">
                <a href="docs-querymodel.html" class="title">
                    <span class="bullet"></span>
                    <span class="text">4. QUERY MODEL</span>
                </a>
                <div class="l2">
                    <div class="l3 collapsed expanded">
                        <a href="docs-querymodel.html#query_actor" class="title">
                            <span class="bullet"></span>
                            <span class="text">4.1 ACTOR statement</span>
                        </a>
                        <a href="docs-querymodel.html#h_411" class="last">4.1.1 Single actor</a>
                        <a href="docs-querymodel.html#h_412" class="last">4.1.2 Multiple actors</a>
                        <a href="docs-querymodel.html#h_413" class="last">4.1.3 All actors of a type</a>
                        <a href="docs-querymodel.html#h_414" class="last">4.1.4 Loop over actors</a>
                    </div>
                </div>
                <div class="l2">
                    <div class="l3 collapsed expanded">
                        <a href="docs-querymodel.html#query_variables" class="title">
                            <span class="bullet"></span>
                            <span class="text">4.2 Variables</span>
                        </a>
                        <a href="docs-querymodel.html#h_421" class="last">4.2.1 Appending columns to result</a>
                    </div>
                    
                        
                </div>
               
                        <a href="docs-querymodel.html#query_pragma" class="last">
                            
                            <span class="text">4.3 Pragma statement</span>
                        </a>
                   

            </div>


            <div class="l1">
                <div class="l3 collapsed ">
                        <a href="docs-kvstore.html" class="title">
                            <span class="bullet"></span>
                            <span class="text">5. KEY/VALUE STORE</span>
                        </a>
                        <a href="docs-kvstore.html#about_kv_store" class="last">5.1 About</a>
                        <a href="docs-kvstore.html#reliable_distributed_counters" class="last">5.2 Use case: reliable distributed counters</a>
                </div>
                

                
            </div>
           
            <div class="l1 collapsed expanded">
                <a href="docs-examples.html" class="title">
                    <span class="bullet"></span>
                    <span>6. EXAMPLES</span>
                </a>
                <!-- <a href="docs-examples.html" class="last">
                    <span>Introduction</span>
                </a> -->
                <a href="docs-examples.html#example_filesync" class="last">
                    <span>6.1 File sync</span>
                </a>
            </div>

            <div class="l1 collapsed ">
                <a href="docs-configuration.html" class="title">
                    <span class="bullet"></span>
                    <span class="text">7. CONFIGURATION</span>
                </a>
                <a href="docs-configuration.html#conf_files" class="last">
                    <span>7.1 ActorDB configuration files</span>
                </a>
                <a href="docs-configuration.html#conf_nodes" class="last">
                    <span>7.2 init.sql</span>
                </a>
                <a href="docs-configuration.html#setup_guide" class="last">
                    <span>7.3 Setup guide</span>
                </a>
                <a href="docs-configuration.html#changing_schema" class="last">
                    <span>7.4 Changing schema</span>
                </a>
                <a href="docs-configuration.html#adding_cluster" class="last">
                    <span>7.5 Adding a cluster</span>
                </a>
                <a href="docs-configuration.html#building_actordb" class="last">
                    <span>7.6 Building ActorDB</span>
                </a>
                <a href="docs-configuration.html#running_dev_mode" class="last">
                    <span>7.7 Running ActorDB development mode</span>
                </a>
            </div>

        </div>
        <div class="content">

   				<h1 id="examples" class="pagetitle">6. Examples</h1>

<h2 id="example_webforum" class="pagesubtitle">6.1 File sync</h2>

<p class="pagetext">A perfect use case for ActorDB is a file sync app (Dropbox, EmitCloud, ownCloud,..). A database for a file sync app needs to store:</p>
<p class="pagetext">
<ol>
<li>- a file directory structure for every user,</li>
<li>- an event log for every user (we will skip this part, its a simple continuous table with an auto increment id),</li>
<li>- a list of files our users have uploaded (we must run a distributed file system)</li>
</ol>
</p>
<p class="pagetext"></p>
<p class="pagetext">Schema:</p>


            <div class="structure">
                <pre class="latomono">
-- Users have files and folders. Files always need a parent folder. All folders except root folder have parents.
actor user
CREATE TABLE file (id PRIMARY KEY INTEGER, parent INTEGER NOT NULL, name TEXT NULL, fsid TEXT, FOREIGN KEY (parent) REFERENCES dir(id) ON UPDATE CASCADE)
CREATE TABLE dir (id PRIMERY KEY INTEGER, parent INTEGER, name TEXT NOT NULL, FOREIGN KEY (parent) REFERENCES dir(id) ON UPDATE CASCADE)

-- A distributed filesystem is global. Create a kv to store the position of files.
-- For every file, we also need a table of nodes that store this file.
actor filesystem kv
CREATE TABLE actors (id TEXT PRIMARY KEY, hash INTEGER, crc INTEGER NULL, mime TEXT NULL, size INTEGER NULL) WITHOUT ROWID
CREATE TABLE nodes (id TEXT, node TEXT NOT NULL, FOREIGN KEY(id) REFERENCES actors(id) ON DELETE CASCADE, PRIMARY KEY (id,node)) WITHOUT ROWID
</pre></div>


            <!-- <hr class="hr14colorsmalmargin" /> -->
<p class="pagetext">Tables "file" and "dir" are inside an individual actor. When a user is changing his files and we must store that new info, we do not need to modify giant tables that also contain data for thousands of other users. </p>
<p class="pagetext">Storing actual files in our system also requires a database. At least we must keep track which servers have those files. It is also ideal if we can avoid storing the same file more than once. Using the above schema for our filesystem does just that. If our file ID is SHA of the actual file, we do not need to store a file more than once.</p>
<p class="pagetext"></p>

            <h3 class="pagesubtitle">Queries:</h3> 
            
<p class="pagetext">User uploads a new file, we calculated the file SHA during upload. Check if it already exists:</p>

<div class="structure">
<pre class="latomono">
ACTOR filesystem(MYSHA);
SELECT * FROM actors WHERE id='MYSHA';
</pre>
</div>


<p class="pagetext">If no result, we can create a transaction:</p>

<div class="structure">
<pre class="latomono">
ACTOR filesystem(MYSHA);
INSERT OR REPLACE INTO actors VALUES ('MYSHA',{{hash(MYSHA)}}, 123, "text/plain", 123456);
INSERT OR REPLACE INTO nodes VALUES ('MYSHA', 'myserver1'), ('MYSHA','myserver2'), ('MYSHA','myserver3');
ACTOR user(MYUSER);
INSERT INTO files VALUES (1,2, "myfile.txt", 'MYSHA');
</pre>
</div>


<p class="pagetext">We use insert or replace because in the rare event of the same file being uploaded at the exact same time, our transaction does not fail. After transaction is complete and file is uploaded, the individual servers storing it can check if they won the race.</p>

<p class="pagetext">Renaming a file:</p>

<div class="structure">
<pre class="latomono">
ACTOR user(MYUSER);
UPDATE file SET name='newname' WHERE id=1;
</pre>
</div>

<p class="pagetext">And so on.</p>

<div class="pageactions">
    <span class="goleft"><a href="docs-kvstore.html"><span class="pagebtn"><< Previous</span></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(5. Key/Value store)</span>
    <span class="goright">(7. Configuration)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="docs-configuration.html"><span class="pagebtn">Next >></span></a></span>   
</div>


            <p class="pagetext"></p>



   			<p class="pagetext">&nbsp;</p>
            <p class="pagetext">&nbsp;</p>
            <p class="pagetext">&nbsp;</p>
            <p class="pagetext">&nbsp;</p>
            <p class="pagetext">&nbsp;</p>
            <p class="pagetext">&nbsp;</p>
            <p class="pagetext">&nbsp;</p>
            <p class="pagetext">&nbsp;</p>
            <p class="pagetext">&nbsp;</p>
            <p class="pagetext">&nbsp;</p>
            <p class="pagetext">&nbsp;</p>

        </div>
    </div>
</div>

        <div class="footer">
            <div class="pagewrapper">
                <div class="linkholder">
                    <a href="https://www.github.com/biokoda/actordb" class="link">GitHub</a>
                    <a href="https://github.com/biokoda/actordb/issues" class="link">Issues</a>
                    <a href="https://github.com/biokoda/actordb/blob/master/README.md" class="link marginrightzero">Changelog</a>
                </div>
                <p class="text">Product by Biokoda. <br/ >
                    Licensed under Mozilla Public License 2.0.
                </p>
                <a class="global-footer_logo"></a>        
            </div>
        </div>

        <!--<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>-->
        <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.10.1.min.js"><\/script>')</script>
        <script src="js/vendor/bootstrap.min.js"></script>
        <script src="js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>
        
        <script type="text/javascript">
            var isAtLeastIE11 = !!(navigator.userAgent.match(/Trident/) && !navigator.userAgent.match(/MSIE/));
            if (isAtLeastIE11) {
                $("html").addClass("ieedge");
            }
            if (navigator.platform.indexOf("Win") != -1 && navigator.userAgent.indexOf("MSIE") != -1 || navigator.platform.indexOf("Win") != -1 && isAtLeastIE11){
                $("html").addClass("iecomm");
            } 
            if (navigator.platform.indexOf("Win") !=-1 && navigator.userAgent.indexOf("Chrome") != -1) {
                $("html").addClass("winchrome");
            }
        </script>
        <!--<script src="js/actordb-website.js"></script>-->
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-47379916-1', 'actordb.com');
          ga('send', 'pageview');

        </script>
    </body>
</html>
